{{left_sidebar_enabled = True}}
{{right_sidebar_enabled=True}}
{{extend 'layout.html'}}

{{response.title = item.question_info}}


<div class="article_container">
  <div>


            <table class="article_tag">
            <tr>
                {{question_tag_list = db(db.question_tag_tbl.question_info == item.id).select()}}
                {{for tag_unit in question_tag_list:}}
               <td>
                   {{tag_record = db(db.tag_tbl.id == tag_unit.tag_info).select().first()}}
                   {{=tag_record.name}}

               </td>
                {{pass}}
           </tr>
         </table>
         <table  class="article_header">
           <tr >
               <td>
                   <div class="article_header_text">
                       {{=item.question_info}}
                   </div>
               </td>
           </tr>
           </table>
           <table class ="article_introduction">
          <tr >
              <td>
                  {{=SPAN(XML(item.question_detail_info), _class='article_introduction_bigger')}}
              </td>
          </tr>
          </table>
          <table class="article_popularity_info">
            <tr>
              <td>
                  {{if auth.is_logged_in():}}
                   <input id="inputCommentButton" name="question_id" value = "tra loi">
                  {{pass}}
              </td>
              <td >
                  {{=len(comment_list)}} trả lời  {{=len(like_list)}} thích
              </td>
                {{if auth.is_logged_in():}}
                <td>
                    {{=A("sửa",_id ='edit_button',_href=URL(r=request,f='edit_question',args=[item.id]))}}
                </td>
                <td>
                    {{=A("xoá",_id='delete_button', _href=URL(r=request,f='delete_question',args=[item.id]))}}
                </td>
               {{pass}}
              <td>
             <!-- <img border="0" src=https://fbcdn-profile-a.akamaihd.net/hprofile-ak-prn2/t1.0-1/p50x50/524680_10151914256443389_1087551412_n.jpg alt="Pulpit rock" width="150" height="150"> -->
                  {{if user_info:}}
                  {{img_path =' https://graph.facebook.com/' + user_info.username + '/picture'}}
                  <!--
                  <img border="0" src={{=img_path}} alt="Pulpit rock" width="50" height="50">
                  -->
                  {{pass}}
                  {{=' bởi    '}}
                  <a id ="user_profile" href="{{=URL(f='user_profile')}}" onclick="location.href=this.href+'?user_id='+{{=user_info.id}}; return false;">  {{=user_info.first_name}}</a>
              </td>

          </tr>

          </table>


   </div>
  <div id="mainContent">





    <form id="realEditor"  action="post_comment" method="post">
        <p>
           <input type="hidden" name="question_id" value = {{=item.id}}>
        </p>
        <!--
        <p>
            <textarea class="ckeditor" cols="80" id="editor1" name="editor1" rows="10">

            </textarea>
        </p>
        -->

                <textarea  id="editor1" name="answer_info" rows="10" >

            </textarea>

        <p>
            <input type="submit" value="Gửi">
        </p>
    </form>
  </div>
   <div >
       <table class="article_comment_container">
        {{for comment in comment_list:}}
      <tr>
        <td>
            <table class="user_comment" >
            <tr class="user_info">
                 <td>
                {{user_info = db(db.auth_user.id == comment.author_info).select().first()}}
                      <a id ="user_profile" href="{{=URL(f='user_profile')}}"  onclick="location.href=this.href+'?user_id='+{{=user_info.id}}; return false;">  {{=user_info.first_name}}</a>
                     {{user_profile = db(db.user_profile.user_info == user_info.id).select().first()}}
                     {{if user_profile:}}
                     <span>{{=XML(user_profile.detail_info)}}</span>
                     {{pass}}
               </td>
           </tr>
            <tr class="comment_info">
                 <td>
                {{=XML(comment.answer_info)}}
               </td>
           </tr>
          <tr class="article_popularity_info">
              <td >
                  {{if auth.is_logged_in():}}
                  {{like_record = db((db.answer_like_tbl.answer_id == comment.id)&(db.answer_like_tbl.user_info == auth.user.id )).select()}}
                  {{if len(like_record):}}
                  <a class ="like_unlike_button" id ="unlike" value ={{=comment.id}} style="color:red;" >thích</a>
                  {{else:}}
                  <a class ="like_unlike_button" id ="like" value ={{=comment.id}} style="color:grey">thích</a>
                  {{pass}}
                  {{pass}}
                  <a>{{='   '}}&nbsp&nbsp&nbsp </a>
                  {{like_record = db((db.answer_like_tbl.answer_id == comment.id)).select()}}
                  <a class="count_like">{{=len(like_record)}}</a><a> thích</a>
                 </td>
              <!--
              <td>bao cao</td>
              -->

          </tr>
            </table>
        </td>
      </tr>
      {{pass}}
    </table>
   </div>

</div>
{{block right_sidebar}}
        <ul id="right_bar_question_list" >
            {{for item in related_question_list:}}
            <li>
                <a id="related_question" href={{=URL(r=request,f='question',args=[item.id])}}>{{=XML(item.question_info)}}</a>
            </li>
            {{pass}}
        </ul>
{{end}}



<script>
$('#realEditor').hide();
$( '#inputCommentButton' ).click(function() {
  $( this ).hide( );
  <!--$( this ).slideUp();-->
    $( '#realEditor' ).show(  );

});

$('#like_button').click(function () {
        alert("hello a ");
         var id = $(this).attr("value");
         alert(id);
        ajax('http://localhost:8002/welcome/default/like_an_answer?answer_id='+ id, [''], 'like_button');
});


     $('.like_unlike_button').click(function () {
         var myThisVariable = $(this);
         var id = $(this).attr("value");
         var like_unlike_val = $(this).html();
         var like_unlike_val = $(this).attr("id");
         //alert(like_unlike_val);
         //alert(like_unlike_val.length);
         //alert(like_unlike_val.localeCompare("quan tâm"));

         if (like_unlike_val == "like")
         {
            //alert('equal like');
             $.ajax({
            type: "POST",
            url: '{{=URL(f='like_an_answer')}}',
            data: {answer_id : id},
            cache: false,
            success: function(data){
                myThisVariable.parent().find('.count_like').text(data);
            }
            });

           $(this).css('color', 'red');
           $(this).attr('id', 'unlike');
         } else
         {
            $.ajax({
            type: "POST",
            url: '{{=URL(f='unlike_an_answer')}}',
            data: {answer_id : id},
            cache: false,
            success: function(data){
                myThisVariable.parent().find('.count_like').text(data);
            }
            });
           $(this).attr('id', 'like');
           $(this).css('color', 'grey');
         }
        });

</script>