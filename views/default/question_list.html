{{left_sidebar_enabled = True}}
{{right_sidebar_enabled=True}}
{{extend 'layout.html'}}
{{block center}}




<div class="article_list_containter">
  <div class="header">
      <!--
      <table class="header_option">
          <tr >
              <td>Dang Hot</td>
              <td>Cho tra loi</td>
          </tr>
      </table>
    <!--
    <h1><img src="../avarta.jpg" width="110" height="102" /></h1>
    <h2 >suy nghĩ của một cô  gái nhỏ</h2>
    -->
    <!-- end #header --></div>
  <div class = "content">
    <h1>  </h1>
    <table class="content_list_table">
        {{for item in items:}}
      <tr>
        <td>
            <table class = "article_tag"  >
                <tr >
                    {{try:}}
                {{question_tag_list = db(db.question_tag_tbl.question_info == item.id).select()}}
                {{for tag_unit in question_tag_list:}}
               <td>
                   {{tag_record = db(db.tag_tbl.id == tag_unit.tag_info).select().first()}}
                   {{=tag_record.name}}


               </td>
                {{pass}}
                    {{except:}}
                    {{pass}}
                </tr>
            </table>
            <table class = "content_info_table"  >

           <tr class="article_header">
               <td>
                   {{try:}}
                   {{=A(item.question_info,_class='article_header', _href=URL(f='question',args=[item.id]))}}
                   {{except:}}
                   {{pass}}
               </td>
           </tr>
          <tr class="article_introduction">
              <td>
                  {{=SPAN(XML(item.question_detail_info), _class='article_introduction')}}
                 <!-- <input type="text" name="article_introduction" value = "quan diem cua ban">-->
                 </td>
          </tr>
          <tr class="article_popularity_info">
              <td >
                  {{try:}}
                  {{if auth.is_logged_in():}}
                  {{like_record = db((db.question_like_tbl.question_id == item.id)&(db.question_like_tbl.user_info == auth.user.id )).select().first()}}
                  {{if like_record:}}
                    <a class ="like_unlike_button" id ="unlike" value ={{=item.id}} style="color:red;" >quan tâm</a>
                  {{else:}}
                     <a class ="like_unlike_button" id ="like" value ={{=item.id}} style="color:grey">quan tâm</a>
                  {{pass}}
                  {{pass}}
                  <!--
                  <button id ="report_button" value={{=item.id}} name="report"> report</button>
                  -->
                  <a>{{='   '}}&nbsp&nbsp&nbsp </a>
                  {{like_record = db((db.question_like_tbl.question_id == item.id)).select()}}
                  <a class="count_like">{{=len(like_record)}}</a><span> quan tâm</span>
                  {{answer_num=len(db(db.answer_tbl.question_id == item.id).select())}}
                  <!--
                  <button id ="view_answer_button" value={{=item.id}} name="view_answer">{{=str(answer_num)+' tra loi'}} </button>
                  -->
                  {{=A("        " + str(answer_num) + " trả lời",_href=URL(r=request,f='question',args=[item.id]))}}
              </td>
              <td>
                  {{writer = db(db.auth_user.id == item.writer).select().first()}}
                  <a id ="user_profile" href={{=URL(r=request,f='user_profile',args=[])}} onclick="location.href=this.href+'?user_id='+{{=item.writer}}; return false;">
                      {{=writer.last_name}}
                   </a>
                  {{except:}}
                  {{pass}}

              </td>
          </tr>
          </table>
        </td>
      </tr>
        {{pass}}
    </table>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <h2></h2>
    <p></p>
    <!-- end #mainContent --></div>
  <div id="footer">
  <!-- end #footer --></div>
<!-- end #container --></div>
     <script>
     // click button
     $('#view_answer_button').click(function () {
         var id = $(this).attr("value");
        });
     $('#report_button').click(function () {
         var id = $(this).attr("value");
        ajax('report_a_question?question_id='+ id, [''], 'report_button');
        });
     $('.like_unlike_button').click(function () {
         var myThisVariable = $(this);
         var id = $(this).attr("value");
         var like_unlike_val = $(this).html();
         var like_unlike_val = $(this).attr("id");
         //alert(like_unlike_val);
         //alert(like_unlike_val.length);
         //alert(like_unlike_val.localeCompare("quan tâm"));

         if (like_unlike_val == "like")
         {
            //alert('equal like');
             $.ajax({
            type: "POST",
            url: "like_a_question",
            data: {question_id : id},
            cache: false,
            success: function(data){
                myThisVariable.parent().find('.count_like').text(data);
            }
            });

           $(this).css('color', 'red');
           $(this).attr('id', 'unlike');
         } else
         {
            $.ajax({
            type: "POST",
            url: "unlike_a_question",
            data: {question_id : id},
            cache: false,
            success: function(data){
                myThisVariable.parent().find('.count_like').text(data);
            }
            });
           $(this).attr('id', 'like');
           $(this).css('color', 'grey');
         }
        });
      </script>
{{end}}

{{block right_sidebar}}
        <div id="right_bar_info" >
            {{=A('Vi sao co chuotnhat.vn',_class='mission_info_link', _href=URL(f='mission_info',args=[]))}}
            </div>
{{end}}
</html>


